version: 1

collection:
  metrics:
    - "gpu__time_duration.sum"

    - "sm__throughput.avg.pct_of_peak_sustained_elapsed"
    - "gpu__compute_memory_throughput.avg.pct_of_peak_sustained_elapsed"
    - "gpu__dram_throughput.avg.pct_of_peak_sustained_elapsed"
    - "lts__throughput.avg.pct_of_peak_sustained_elapsed"
    - "l1tex__throughput.avg.pct_of_peak_sustained_active"

    - "sm__warps_active.avg.pct_of_peak_sustained_active"

    - "sm__inst_executed_pipe_fma.avg.pct_of_peak_sustained_active"
    - "sm__inst_executed_pipe_alu.avg.pct_of_peak_sustained_active"
    - "sm__inst_executed_pipe_fp64.avg.pct_of_peak_sustained_active"
    - "sm__inst_executed_pipe_lsu.avg.pct_of_peak_sustained_active"
    - "sm__inst_executed_pipe_tensor_op_gmma.avg.pct_of_peak_sustained_active"
    - "sm__inst_executed_pipe_tensor.avg.pct_of_peak_sustained_active"

    - "smsp__warp_issue_stalled_long_scoreboard_per_warp_active.pct"
    - "smsp__warp_issue_stalled_lg_throttle_per_warp_active.pct"
    - "smsp__warp_issue_stalled_drain_per_warp_active.pct"
    - "smsp__warp_issue_stalled_barrier_per_warp_active.pct"
    - "smsp__warp_issue_stalled_not_selected_per_warp_active.pct"

u_vector:
  dims:
    - name: "u_sm_sol"
      source: "sm__throughput.avg.pct_of_peak_sustained_elapsed"
      transform: "pct_to_unit"
    - name: "u_mem_sol"
      source: "gpu__compute_memory_throughput.avg.pct_of_peak_sustained_elapsed"
      transform: "pct_to_unit"
    - name: "u_dram_sol"
      source: "gpu__dram_throughput.avg.pct_of_peak_sustained_elapsed"
      transform: "pct_to_unit"
    - name: "u_l2_sol"
      source: "lts__throughput.avg.pct_of_peak_sustained_elapsed"
      transform: "pct_to_unit"
    - name: "u_l1tex_sol"
      source: "l1tex__throughput.avg.pct_of_peak_sustained_active"
      transform: "pct_to_unit"

    - name: "u_occupancy"
      source: "sm__warps_active.avg.pct_of_peak_sustained_active"
      transform: "pct_to_unit"

    - name: "u_pipe_fma"
      source: "sm__inst_executed_pipe_fma.avg.pct_of_peak_sustained_active"
      transform: "pct_to_unit"
    - name: "u_pipe_alu"
      source: "sm__inst_executed_pipe_alu.avg.pct_of_peak_sustained_active"
      transform: "pct_to_unit"
    - name: "u_pipe_fp64"
      source: "sm__inst_executed_pipe_fp64.avg.pct_of_peak_sustained_active"
      transform: "pct_to_unit"
    - name: "u_pipe_lsu"
      source: "sm__inst_executed_pipe_lsu.avg.pct_of_peak_sustained_active"
      transform: "pct_to_unit"
    - name: "u_pipe_tensor"
      reduce: "max"
      sources:
        - "sm__inst_executed_pipe_tensor_op_gmma.avg.pct_of_peak_sustained_active"
        - "sm__inst_executed_pipe_tensor.avg.pct_of_peak_sustained_active"
      transform: "pct_to_unit"

    - name: "stall_long_scoreboard"
      source: "smsp__warp_issue_stalled_long_scoreboard_per_warp_active.pct"
      transform: "pct_to_unit"
    - name: "stall_lg_throttle"
      source: "smsp__warp_issue_stalled_lg_throttle_per_warp_active.pct"
      transform: "pct_to_unit"
    - name: "stall_drain"
      source: "smsp__warp_issue_stalled_drain_per_warp_active.pct"
      transform: "pct_to_unit"
    - name: "stall_barrier"
      source: "smsp__warp_issue_stalled_barrier_per_warp_active.pct"
      transform: "pct_to_unit"
    - name: "stall_not_selected"
      source: "smsp__warp_issue_stalled_not_selected_per_warp_active.pct"
      transform: "pct_to_unit"

aggregation:
  weight_source: "gpu__time_duration.sum"
  weight_unit: "ns"
  mode: "time_weighted_mean"

transforms:
  pct_to_unit:
    type: "scale"
    scale: 0.01
    clamp: [0.0, 1.0]

missing_metric_policy: "drop_or_zero"
